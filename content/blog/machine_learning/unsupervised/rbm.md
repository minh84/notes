+++
date          = "2017-05-18"
title         = "Restricted Boltzmann Machine"
type          = "subblog"
showonlyimage = true
draft         = false
author        = "Minh VU"
image         = "img/rbm_logo.png"
description   = "Restricted Bolztmann Machine is an unsupervised neural network that allows we learn distribution of binary state vector from unlabled data. This can be considered as pretraining for Deep Neural Net."
+++


<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <p>
    A
    <a href="https://en.wikipedia.org/wiki/Restricted_Boltzmann_machine">
     RBM
    </a>
    is a generative stochastic artificial neural network that can learn a probability distribution over its set of inputs.
   </p>
   <p>
    A standard RBM has following diagram
   </p>
   <p>
    <img alt="rbm-diagram" src="./assets/rbm-diagram.png" style="width: 40%; height: 40%"/>
   </p>
   <p>
    where we denote
   </p>
   <ul>
    <li>
     $v\in\mathbb{R}^D$ is visible units
    </li>
    <li>
     $h\in\mathbb{R}^H$ is hidden units
    </li>
   </ul>
   <p>
    And $v,h$ takes binary value (0,1), then it defines an energy function (similar as Hopfield network)
$$
E(v,h) = -a^Tv -b^Th - v^TWh
$$
which allows us to model the joint-distribution $(v,h)$ in term of the energy function i.e
$$
P(v,h) = \frac{1}{Z}e^{-E(v,h)}
$$
where $Z$ is normalized constant i.e
$$
Z = \sum_{v,h}e^{-E(v,h)}
$$
   </p>
   <p>
    The above diagram is a bipartite graph which allows to define conditional probability 
$$
\begin{split}
P(v|h) &amp;= \prod_{i=1}^DP(v_i|h)\\
P(h|v) &amp;= \prod_{j=1}^HP(h_j|v)
\end{split}
$$
where individual probability is given by
$$
\begin{array}{rl}
P(v_i=1|h) &amp;= \sigma\left(a_i + \sum_{j=1}^{H}w_{i,j}h_j\right)\\
P(h_j=1|v) &amp;= \sigma\left(b_j + \sum_{i=1}^Dw_{i,j}v_i\right)
\end{array}
$$
   </p>
   <h3 id="RBM-task">
    RBM task
    <a class="anchor-link" href="#RBM-task">
     ¶
    </a>
   </h3>
   <p>
    In this note, we look at the following task
   </p>
   <ul>
    <li>
     given a set of unlabelled dataset $\left\{v^{(i)}\right\}_{i=1}^n$
    </li>
    <li>
     given a configuration of RMB e.g number of hidden units $H$
    </li>
   </ul>
   <p>
    The goal is to learn $a$, $b$ and $W$ that model the joint-distribution directly from dataset $\left\{v^{(i)}\right\}_{i=1}^n$ i.e that maximize the sum of log-likelihood
$$
\sum_{i=1}^n\log\left(P(v^{(i)})\right)
$$
where 
$$
P(v) = \sum_{h}P(v,h)=\frac{1}{Z}\sum_{h}e^{-E(v,h)}
$$
   </p>
   <h3 id="How-to-train-RBM">
    How to train RBM
    <a class="anchor-link" href="#How-to-train-RBM">
     ¶
    </a>
   </h3>
   <p>
    The learning for RBM is difficult since computation of $Z$ is exponentially hard, however we have the following interesting fact
   </p>
   $$
\begin{split}
\frac{\partial \log P(v)}{\partial w_{i,j}} &amp;= \langle v_i,h_j\rangle_{data} - \langle v_i,h_j\rangle_{model}\\
\frac{\partial \log P(v)}{\partial a_i} &amp;= \langle v_i\rangle_{data} - \langle v_i\rangle_{model} \\
\frac{\partial \log P(v)}{\partial b_j} &amp;= \langle h_j\rangle_{data} - \langle h_j\rangle_{model}
\end{split}
$$
   <p>
    where
   </p>
   <ul>
    <li>
     $\langle v_i, h_j\rangle_{data}$ is expected value of the product when $v$ is clamped on data (i.e $v_i$ is taken from training dataset)
    </li>
    <li>
     $\langle v_i, h_j\rangle_{model}$ is expected value of the product when $v,h$ is generated by model
    </li>
    <li>
     $\langle v_i\rangle_{data}, \langle h_j\rangle_{data}, \langle v_i\rangle_{model}, \langle h_j\rangle_{model}$ are defined similarly
    </li>
   </ul>
   <p>
    Now let's look at how we compute $\langle v_i,h_j\rangle_{data}$ and $\langle v_i,h_j\rangle_{model}$, it's done via two phases
   </p>
   <ul>
    <li>
     <strong>
      positive phase
     </strong>
     : clamp a datavector on the visible units, then we sample $h$ and compute the average $\langle v,h\rangle $
    </li>
    <li>
     <strong>
      negative phase
     </strong>
     : keep a set of fantasy particles $v$ where each particle has a value that is a global configuration, then we sample $h$ and compute the average $\langle v,h\rangle $
    </li>
   </ul>
   <p>
    To illustrate the process, we show the following diagram is taken from G. Hinton's course (NN)
    <img alt="rbm-pos-neg" src="./assets/rbm-pos-neg.png" style="width: 60%; height: 50%"/>
   </p>
   <p>
    and the update rule for $W$
$$
\Delta w_{i,j} = \epsilon\left( \langle v_i,h_j\rangle^0 - \langle v_i,h_j\rangle^\infty \right)
$$
This is actually based on Markov Chain Monte Carlo (MCMC) and Gibbs sampling. However this's still not efficient enough.
   </p>
   <p>
    Fortunately, G. Hinton introduces a very fast learning algorithm so called
    <strong>
     Constrative Divergence Learning
    </strong>
    where we can use a short cut
    <img alt="rbm-cd-learning" src="./assets/rbm-cd-learning.png" style="width: 60%; height: 50%"/>
    we denote 
$$
CD_1 = \langle v_i,h_j\rangle^0 - \langle v_i,h_j\rangle^1
$$
we can similarly define $CD_t = \langle v_i,h_j\rangle^0 - \langle v_i,h_j\rangle^t$, so the update rule can be written as
$$
\begin{split}
\Delta w_{i,j} &amp;= \epsilon CD_1\\
\Delta a_i &amp;= \epsilon\left(\langle v_i\rangle^0 - \langle v_i\rangle^1\right)\\
\Delta b_j &amp;= \epsilon\left(\langle h_j\rangle^0 - \langle h_i\rangle^1\right)
\end{split}
$$
   </p>
   <p>
    One can see that the learning doesn't use the correct gradient of the log-likelihood, as suggested by G. Hinton, we can use the following process
   </p>
   <ul>
    <li>
     start with small weight $w_{i,j}$
    </li>
    <li>
     for the first few iteration and we use $CD_1$
    </li>
    <li>
     then after some number of iterations, we can use $CD_3$, then $CD_{10}$
    </li>
   </ul>
   <h2 id="Implement-RBM">
    Implement RBM
    <a class="anchor-link" href="#Implement-RBM">
     ¶
    </a>
   </h2>
   <p>
    It's time to implement RBM for the above task, we will consider MNIST dataset for this task, then later we go through some RBM's application.
   </p>
   <p>
    First we load needed modules
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [5]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class=" highlight hl-ipython3">
     <pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># add parent to search path</span>
<span class="k">if</span> <span class="s1">'..'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'..'</span><span class="p">)</span>

    
<span class="c1"># for auto-reloading external modules</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">from</span> <span class="nn">helpers</span> <span class="k">import</span> <span class="n">rbm</span>
</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <p>
    Now let's download MNIST dataset
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [2]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class=" highlight hl-ipython3">
     <pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.examples.tutorials.mnist</span> <span class="k">import</span> <span class="n">input_data</span>

<span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">one_hot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Extracting ./train-images-idx3-ubyte.gz
Extracting ./train-labels-idx1-ubyte.gz
Extracting ./t10k-images-idx3-ubyte.gz
Extracting ./t10k-labels-idx1-ubyte.gz
</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <p>
    Let's inspect the data a bit
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [62]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class=" highlight hl-ipython3">
     <pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'number of training point:'</span><span class="p">,</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">num_examples</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'shape of training data:  '</span><span class="p">,</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">labels</span><span class="o">==</span><span class="mi">1</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">draw_digit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Training data, index: </span><span class="si">{}</span><span class="s1">,  Label: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'gray_r'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Function for displaying a training image by it's index in the MNIST set</span>
<span class="k">def</span> <span class="nf">show_digit</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Reshape 784 array into 28x28 image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">])</span>    
    <span class="n">draw_digit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">show_digit</span><span class="p">(</span><span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">images</span><span class="p">,</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   

<span class="c1"># let reshape data</span>
<span class="n">train_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">images</span><span class="p">,</span>      <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">])</span>
<span class="n">valid_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mnist</span><span class="o">.</span><span class="n">validation</span><span class="o">.</span><span class="n">images</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">])</span>

<span class="n">train_y</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">labels</span>
<span class="n">valid_y</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">validation</span><span class="o">.</span><span class="n">labels</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>number of training point: 55000
shape of training data:   (55000, 28, 28, 1)
</pre>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_png output_subarea ">
     <img src="data:image/png;base64,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
"/>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <p>
    Let's train MNIST using RBM
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [119]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class=" highlight hl-ipython3">
     <pre><span></span><span class="n">num_hiddens</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">rbm_model</span> <span class="o">=</span> <span class="n">rbm</span><span class="o">.</span><span class="n">RBMachine</span><span class="p">(</span><span class="n">train_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_hiddens</span><span class="p">)</span>

<span class="n">epochs</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">1e-1</span>
<span class="n">rbm_model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">valid_X</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="n">cd_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_pcd</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Epoch (1/20)Step   400 Loss 0.0662 

Epoch (2/20)Step   850 Loss 0.0578 

Epoch (3/20)Step  1250 Loss 0.0542 

Epoch (4/20)Step  1700 Loss 0.0515 

Epoch (5/20)Step  2100 Loss 0.0498 

Epoch (6/20)Step  2550 Loss 0.0486 

Epoch (7/20)Step  3000 Loss 0.0462 

Epoch (8/20)Step  3400 Loss 0.0458 

Epoch (9/20)Step  3850 Loss 0.0455 

Epoch (10/20)Step  4250 Loss 0.0445 

Epoch (11/20)Step  4700 Loss 0.0441 

Epoch (12/20)Step  5100 Loss 0.0436 

Epoch (13/20)Step  5550 Loss 0.0430 

Epoch (14/20)Step  6000 Loss 0.0427 

Epoch (15/20)Step  6400 Loss 0.0421 

Epoch (16/20)Step  6850 Loss 0.0414 

Epoch (17/20)Step  7250 Loss 0.0415 

Epoch (18/20)Step  7700 Loss 0.0408 

Epoch (19/20)Step  8150 Loss 0.0406 

Epoch (20/20)Step  8550 Loss 0.0404 

</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h3 id="Visualize-RBM-re-construction-phase">
    Visualize RBM re-construction phase
    <a class="anchor-link" href="#Visualize-RBM-re-construction-phase">
     ¶
    </a>
   </h3>
   <p>
    We can use RBM to re-construct the input from hidden layer
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [114]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class=" highlight hl-ipython3">
     <pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">valid_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">valid_X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">v1_probs</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">rbm_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">num_gibbs_step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">draw_digit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v0</span><span class="p">,[</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">]),</span> <span class="s1">'un-labelled'</span><span class="p">,</span> <span class="s1">'random'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">draw_digit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v1_probs</span><span class="p">,[</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">]),</span> <span class="s1">'un-labelled'</span><span class="p">,</span> <span class="s1">'random'</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_png output_subarea ">
     <img src="data:image/png;base64,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
"/>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_png output_subarea ">
     <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATUAAAEICAYAAAA++2N3AAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAALEgAACxIB0t1+/AAAGVZJREFUeJzt3X+cXXV95/HXm5AQyA8IJMYAgUkgQkPZQjuL8sC6tFAX
bA2iLZWq4KqELUq1Sx9bZNclD8tW3GpoKRULwoKiaED5IQ+UIi1FWQpOWH4ksAtsTAwYkokJJIFQ
8uOzf5wz9mY693tmJsM9537zfj4e85h77+eeez/nnDvve8653zlXEYGZWS72qrsBM7Ox5FAzs6w4
1MwsKw41M8uKQ83MsuJQM7OsdDTUJI2TtEXSYWN53zHo61RJK9/o52nz3J+R9OVRTltb32NJ0pGS
unZs0e70X+e8j+T1I+ljku4f5fP8YlpJe0sKST2jeJxhTZsMtTJUBn52Stracv0DI20qInZExOSI
+OlY3reTdmflDiUi/iwi/uNYPZ6NXi5vEnu6vVPFiJg8cLlc2R+LiB+0u7+kvSNi+9i1Z03k9WxN
tlu7n5Iuk/QtSTdL2gx8UNKJkv5J0kuS1ki6UtL48v67bD5Kuqmsf0/SZkkPSZoz0vuW9dMlPSPp
ZUl/LelBSR9u0/d+kr4maaOk5cCvDar/V0kryudZLmlBefuxwFXAr5dbq+vL2xdIekzSJkk/lfSZ
ES7DG8rLR5bzfI6k5yX1S7p4BH0fKum2crqfSPp4ebsk3SPp8y33vVXSNSPocTTr+XxJz5X9Xtny
eOMkXSHp55JWAKcNMR93Sdog6VlJHxnUyzfLXrZIelzSEeU66y+X/6nDXf7DNZx1LOk8ST8rf/64
5fa9JF0i6f9JWl/2P20UPfyr3a/y72JReflUSSsl/edyWfxM0jkjePwhX/ct9pL0pfJv7GlJv9Ey
7QGS/mf5Wnhe0mclVeaLpImSFktaLWlt+fgTW+oXS3pR0gvAucOakYgY1g+wEjh10G2XAa8D76YI
yH2Bfwu8lWIrcC7wDPCJ8v57AwH0lNdvAtYDvcB44FvATaO475uAzcAZZe0/AduAD7eZly8A9wPT
gMOBp4CVLfWzgFnlPP0BsAWYWdY+Btw/6PF+EzimvP+vlH3+zjCX62XADeXlI8t5/jIwEfhV4J+B
eVV9l8/9GHAJMKF8rJXAKWX9YKAfeAfFi+M5YFJZmwO8BByc6HE06/kOYH+gB9gw8PoBPgEsBw4F
DgIeAKLl+R4E/rplGawH/l1LL1uBU8vn+QbwE+Di8vofAs8O93U9aD5PbX0dDHcdt6y3rwH7lfWf
AyeX9YvKeTqknKevAF9rnbblef4LcHubHnb5m2j5u1jU0v924FKKv4MFwCvA1OHML9Wv++3AH5WP
/QfARuCAsv5d4Evl/M8ElgIfHfw3M3geyvV8G8VreipwN/BnZe13gDXAfGASsGTw/A85X2MQan9f
Md2fALckgurLLfddACwbxX0/AvywpaZyYbQLtZ+2zgtwAW1ezGV9GfDb7UJtiPtfBfzFMJfrUKH2
5pb6o8DvVvUNnASsGPTYnwGubbn+++Vj/Bw4cQTrfrTr+W0t9e8Af1JefoDiUMZA7V2Uf9gUAbuN
MnDL2/4C+EpLL99rqZ0JvAzsVV6fVj735OHOX8tjtQ211DpuWW9HttQXA39bXn6WMpTL67OB1yjC
Y5dQq3jO4YTaFmBcS30D0Dua+R3idb8a0KDX5tkUYb0V2Kel9iHg3sF/M63zUM7/a8DhLdP9OuWb
EvBV4LKW2vzB8z/UT/KY2jCtbr0i6WjgixS7RvuVM/FwYvoXWy6/Ckxud8fEfQ9u7SMiQtLziceZ
NajvVa1FFbutf0yxNUT5PNPbPZikE4HPUbyTTwD2AW5OPH9SRLSbz1TfhwOHSXqp5bZxFFt2A+4A
rqR4M3hohG2NZj0Pa32x63wcDKyPiFcG1X+55fralstbgf6I2NlynfK5tiTmZ0SGuY4Hz9PAbvBh
wHcl7Rx0/zeNVX8t1kfEjpbrrwKTJc0Fnihv2x4RBwyecBiv++cH3nlKqyjW1+EUy2OtpIHaXhQb
QilvLqd7vGU6tdQPptjCbX2+SmMxpGPwx9F/S5HwR0bEVOC/sWujb4Q1FLsyQHEMieLdo50XKd4t
B/xi2Ei58q+m2I05qFz5/4d/mYehPn7/JvBtYHZE7E+xe/FGzHPbvin+oJ6NiANafqZExLtb7vM5
4HGgR9LvjfC5x3I9r6H9fPwMmC5p0qD6CyNrd8wNZx0PnqeflZefB35r0LqZOOjNq1IUH878M8Wb
yIA3D3PaFVGMJpjcJtCqXvfQ8jdWGpjH1RTheWDL/E2NiH9T0dZaisMaR7VMt3+5fCH9OmnrjRin
NoVid+AVSb8EnP8GPMdgdwG/KundkvYGPgnMSNx/CXBJeXDzMIpjPAMmU/wB91Pk43nA0S31tcCh
AwfFS1OADRHxmqS3Ae9vfbLywOkHRztzw+z7IeB1SReVB1/HSTpW0q+VPfwm8AHgHIpjal+SNGs3
etmd9bwE+JSkQyQdBPzpQCEifgL0AX8uaR9JxwH/gWI3a8TKDxbafmI/9CSaOOhHVKzj0mck7avi
A6VzKY77QnGM9M/LdYakNw1xEH64Hgc+UK7f3wbePsrHGazqdQ8wS9Inyg8s3g8cAXw/IlYD/wh8
QdLU8oORIyW9I/WE5RblV4C/lDRDhUMlvbO8yxLgI5KOLt/kLh3OjLwRoXYRxQrdTPFu/q303Xdf
RKylOF60mOJ40RHA/6Z4VxvKpRTvAiuB71Hsuw881hMUBy8fKe9zFLvuVt1LcYxkraSBd9o/BD6n
4pPBSyhWBlB8ukNxnCe1Cz5cqb63UxybOqGsr6dY/lMlHQDcAFwQES9GxP3ltNeVPc5V8UniwSPo
ZXfW89XAfcCTwI+BWwfVfx+YR7FleitwSdnzaMxm112YKodR7MK2/hxOYh23+BGwAvg74HMR8ffl
7YuB7wP3ldP/L4oPWv4VFYOxv5vo748ojiO+BPwecOcI5q2tYbzuoej7GIrjdIuA90XExrL2QYqD
+U9RfIBwC8PbiryIYrfyEYo3yb+jWPdExHeBv6EIzGco/vYqaddd5DxIGkexWfy7EfHDmns5meJT
oA/V2ceeStITFAfpN1be2bKQTahJOg34J4p31k9TfOJyRES021ozswzl9A/tb6fY9O8H/j1wpgPN
bM+TzZaamRnktaVmZjYmg29rMX369Ojp6am7DbOsLV26dH1EpIZHNU5jQq080P9XFKPgvxIRl6fu
39PTQ19fX0d6M9tTSRrWKP4macTuZzkE42+A0yn+v+tsSfPr7crMulEjQo1iwOhz5b9yvE7xLyln
1NyTmXWhpoTaIez6z8DPM8T/bkpaKKlPUl9/f3/HmjOz7tGUUBuWiLgmInojonfGjK46dmlmHdKU
UHuBXf8b/1DqPyuDmXWhpoTaj4F5kuZImkBxBoQx+UddM9uzNGJIR0Rsl/QJ4B6KIR3XR8Tymtsy
sy7UiFADiIi7Kc5PbmY2ak3Z/TQzGxMONTPLikPNzLLiUDOzrDjUzCwrDjUzy4pDzcyy4lAzs6w4
1MwsKw41M8uKQ83MsuJQM7OsONTMLCuNOUuHNcPOnTvb1vbay++B1nx+lZpZVhxqZpYVh5qZZcWh
ZmZZcaiZWVYcamaWFYeamWXF49RqEBGjqg3H6tWrk/ULL7wwWZ86dWrb2mmnnZac9qCDDkrWjzrq
qGR9v/32S9YnTZo0qhp4jN2exGvazLLiUDOzrDjUzCwrDjUzy4pDzcyy4lAzs6w41MwsKx6nVoMd
O3a0rW3YsCE57eLFi5P1G2+8MVl/+eWXk/XUOLlbb701Oe0+++yTrL/3ve9N1j/72c8m6/vuu2/b
Ws7j0KrGLkrqUCfdoVGhJmklsBnYAWyPiN56OzKzbtOoUCv9RkSsr7sJM+tO+W6zm9keqWmhFsAP
JC2VtHBwUdJCSX2S+vr7+2toz8yarmmh9vaIOA44Hfi4pHe0FiPimojojYjeGTNm1NOhmTVao0It
Il4of68DbgNOqLcjM+s2jQk1SZMkTRm4DLwTWFZvV2bWbZr06edM4LZyzM3ewDci4vv1tjQ6VeOK
tm3b1rb2yCOPJKe95557kvWNGzcm66nv9YR0b1VS4+8AbrnllmT9jjvuSNbPOeectrXLL788OW3V
GLomj/Vqcm9N1JhQi4gVwK/U3YeZdbfG7H6amY0Fh5qZZcWhZmZZcaiZWVYcamaWlcZ8+pmTqo/g
U6fJOfbYY5PTzpkzJ1lftWpVsj5u3LhkPTXk4y1veUty2v333z9Zv/fee5P1V155JVm/8sor29Ye
fvjh5LRXXHFFsv7Wt741Wfewiu7hLTUzy4pDzcyy4lAzs6w41MwsKw41M8uKQ83MsuJQM7OseJxa
DSZMmNC2Nnny5OS069atS9ZfffXVZL3qjMGp0wMdffTRyWk3bdqUrC9YsCBZX758ebI+bdq0trWL
LrooOe3xxx+frHscWj68pWZmWXGomVlWHGpmlhWHmpllxaFmZllxqJlZVhxqZpYVj1OrQWpM1Pbt
25PTvvTSS8l66lxtAD09Pcn6EUcc0bZWdb60KVOmJOtVX+9XNU7tsMMOa1ubO3ductqq5WL58Jo2
s6w41MwsKw41M8uKQ83MsuJQM7OsONTMLCsONTPLisepNcy2bduS9apxajt27EjWDz744GS96nxu
KVXnJJs0aVKyfswxxyTrBx544Ih7GhARybrPp5aPjm6pSbpe0jpJy1puO1DSvZKeLX+3PxOgmVmF
Tu9+3gCcNui2i4H7ImIecF953cxsVDoaahHxALBh0M1nADeWl28E3tPJnswsL034oGBmRKwpL78I
zGx3R0kLJfVJ6uvv7+9Md2bWVZoQar8QxdHctkd0I+KaiOiNiN6qLxAxsz1TE0JtraRZAOXv9Ncl
mZklNCHU7gTOLS+fC9xRYy9m1uU6Ok5N0s3AycB0Sc8DlwKXA0skfRRYBZzVyZ6aZp999knWq76/
8vHHH0/WDzrooGQ99b2iVedLqxoLVnWuuP322y9ZT50Treq5q8bvjR8/Plm37tHRUIuIs9uUTulk
H2aWrybsfpqZjRmHmpllxaFmZllxqJlZVhxqZpYVn3qoYaq+hu7zn/98sn7rrbcm6ytWrEjWTztt
8PkG/sXmzZuT086bNy9ZP/HEE5P1Cy64IFlPDekYN25cctq99/ZLfU/hLTUzy4pDzcyy4lAzs6w4
1MwsKw41M8uKQ83MsuJQM7OsqOqULU3V29sbfX19dbcx5nbu3JmsV62vV155JVk/77zzkvVbbrll
1M9dZcKECcn60Ucfnax/+tOfblubP39+ctqenp5kferUqcn6nkrS0ojorbuPkfCWmpllxaFmZllx
qJlZVhxqZpYVh5qZZcWhZmZZcaiZWVY8Tq3L7O44toceeihZX7BgQdva1q1bk9NW9VZ1zrOqr7Gb
PHnyqGoAt99+e7Je9dWDeyqPUzMzq5lDzcyy4lAzs6w41MwsKw41M8uKQ83MsuJQM7Os+MsQu0zq
uy+H46STTkrWly1b1ra2Zs2a5LQbNmxI1qu+0/T8889P1pcvX962VnUeuWuvvTZZv+qqq5L13Vnu
VWMHJY36sasef3cfuxt1dEtN0vWS1kla1nLbIkkvSHqs/HlXJ3sys7x0evfzBmCorwC/IiKOK3/u
7nBPZpaRjoZaRDwApPdRzMx2Q1M+KLhQ0hPl7um0dneStFBSn6S+/v7+TvZnZl2iCaF2NTAXOA5Y
A3yx3R0j4pqI6I2I3hkzZnSqPzPrIrWHWkSsjYgdEbETuBY4oe6ezKx71R5qkma1XD0TaD+mwMys
QkfPpybpZuBkYDqwFri0vH4cEMBK4PyISA+IYs89n1qdql4ru1t/+eWXk/X3ve99bWtV54mbOHFi
sn7TTTcl66effnrbWtV8VY1x292xZG/kWLRuPJ9aRwffRsTZQ9x8XSd7MLO81b77aWY2lhxqZpYV
h5qZZcWhZmZZcaiZWVb8FXnWGFWvxQcffLBtLTXkAqpPTVR1WqRHHnmkbW3OnDnJaauGXLzRQz52
RzcO6fCWmpllxaFmZllxqJlZVhxqZpYVh5qZZcWhZmZZcaiZWVb8FXnWGFXjsebPn9+2duihhyan
feaZZ5L1LVu2JOv3339/21pPT09yWussb6mZWVYcamaWFYeamWXFoWZmWXGomVlWHGpmlhWHmpll
xePUGqbqnGJ1nlurqredO3cm61XnDat6/PHjx7etnXLKKclpq8ap7dixI1l/8skn29ZeffXV5LRT
p05N1utcpznylpqZZcWhZmZZcaiZWVYcamaWFYeamWXFoWZmWXGomVlWOjpOTdJs4KvATCCAayLi
ryQdCHwL6AFWAmdFxMZO9tZJqfFYVWO1dnesWNV4rNRYsq1btyanXbVqVbI+c+bMZP31119P1seN
G9e2dueddyanrVouVVLna5s8eXJyWo9D66xOb6ltBy6KiPnA24CPS5oPXAzcFxHzgPvK62ZmI9bR
UIuINRHxaHl5M/A0cAhwBnBjebcbgfd0si8zy0dtx9Qk9QDHAw8DMyNiTVl6kWL31MxsxGoJNUmT
gW8Dn4qITa21KA4aDXngSNJCSX2S+vr7+zvQqZl1m46HmqTxFIH29Yj4TnnzWkmzyvosYN1Q00bE
NRHRGxG9M2bM6EzDZtZVOhpqKj4Gug54OiIWt5TuBM4tL58L3NHJvswsH50+9dBJwIeAJyU9Vt52
CXA5sETSR4FVwFkd7qujUh/xb9u2LTnt+vXrk/WHHnooWb/sssuS9dSQj9WrVyenfe2115L1KVOm
JOuzZ89O1lNDQtasWdO2NhwHHHBAsr5w4cK2tdRQE+u8joZaRPwIaPcXnT4hlpnZMPg/CswsKw41
M8uKQ83MsuJQM7OsONTMLCsONTPLir8ir2FSXwMHMH369GR93rx5yfrEiROT9aeeeqptbdOmTW1r
w1E1jm3jxvTZplLj+6pOqVT1NXVLlixJ1qvGsVlzeEvNzLLiUDOzrDjUzCwrDjUzy4pDzcyy4lAz
s6w41MwsKx6n1jBVX6c2YcKEZP2YY45J1u++++5kPXVesrvuuis57U033ZSsb9iwIVnfsmVLsj53
7ty2tUWLFiWnPfbYY5P11FfgWXfxlpqZZcWhZmZZcaiZWVYcamaWFYeamWXFoWZmWXGomVlWFBF1
9zAqvb290dfXV3cbNoaqXotVY/jqeuycSVoaEb119zES3lIzs6w41MwsKw41M8uKQ83MsuJQM7Os
ONTMLCsONTPLSkdDTdJsSf8g6SlJyyV9srx9kaQXJD1W/ryrk31ZM0hK/jT1sa1ZOn2SyO3ARRHx
qKQpwFJJ95a1KyLiCx3ux8wy09FQi4g1wJry8mZJTwOHdLIHM8tbbcfUJPUAxwMPlzddKOkJSddL
mtZmmoWS+iT19ff3d6hTM+smtYSapMnAt4FPRcQm4GpgLnAcxZbcF4eaLiKuiYjeiOidMWNGx/o1
s+7R8VCTNJ4i0L4eEd8BiIi1EbEjInYC1wIndLovM8tDpz/9FHAd8HRELG65fVbL3c4ElnWyLzPL
R6c//TwJ+BDwpKTHytsuAc6WdBwQwErg/A73ZWaZ6PSnnz8ChhoUlP4ySjOzYfJ/FJhZVhxqZpYV
h5qZZcWhZmZZcaiZWVYcamaWFYeamWXFoWZmWXGomVlWHGpmlhWHmpllxaFmZllxqJlZVhxqZpYV
RUTdPYyKpH5gVctN04H1NbVTxb2NXFP7gj2rt8MjoqvOnd+1oTaYpL6I6K27j6G4t5Fral/g3prO
u59mlhWHmpllJadQu6buBhLc28g1tS9wb42WzTE1MzPIa0vNzMyhZmZ56fpQk3SapP8r6TlJF9fd
TytJKyU9KekxSX0193K9pHWSlrXcdqCkeyU9W/6e1qDeFkl6oVx2j0l6V029zZb0D5KekrRc0ifL
22tddom+GrHc6tTVx9QkjQOeAX4LeB74MXB2RDxVa2MlSSuB3oiofaCmpHcAW4CvRsQvl7f9D2BD
RFxeviFMi4g/bUhvi4AtEfGFTvczqLdZwKyIeFTSFGAp8B7gw9S47BJ9nUUDlludun1L7QTguYhY
ERGvA98Ezqi5p0aKiAeADYNuPgO4sbx8I8UfRce16a0RImJNRDxaXt4MPA0cQs3LLtHXHq/bQ+0Q
YHXL9edp1ooN4AeSlkpaWHczQ5gZEWvKyy8CM+tsZggXSnqi3D2tZde4laQe4HjgYRq07Ab1BQ1b
bp3W7aHWdG+PiOOA04GPl7tZjRTFcYgmHYu4GpgLHAesAb5YZzOSJgPfBj4VEZtaa3UuuyH6atRy
q0O3h9oLwOyW64eWtzVCRLxQ/l4H3Eaxu9wka8tjMwPHaNbV3M8vRMTaiNgRETuBa6lx2UkaTxEc
X4+I75Q3177shuqrScutLt0eaj8G5kmaI2kC8H7gzpp7AkDSpPIALpImAe8ElqWn6rg7gXPLy+cC
d9TYyy4GAqN0JjUtO0kCrgOejojFLaVal127vpqy3OrU1Z9+ApQfWf8lMA64PiL+e80tASBpLsXW
GcDewDfq7E3SzcDJFKemWQtcCtwOLAEOoziN01kR0fED9m16O5liFyqAlcD5LcewOtnb24EfAk8C
O8ubL6E4flXbskv0dTYNWG516vpQMzNr1e27n2Zmu3ComVlWHGpmlhWHmpllxaFmZllxqJlZVhxq
ZpaV/w+i7vBiAUwnSQAAAABJRU5ErkJggg==
"/>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h3 id="Visualize-RBM-as-generative-model">
    Visualize RBM as generative model
    <a class="anchor-link" href="#Visualize-RBM-as-generative-model">
     ¶
    </a>
   </h3>
   <p>
    Let's try using Gibbs sampling
$$
\begin{array}{rcl}
v_0 &amp; =&amp;\text{randomly selected from validation-set or test-set}\\
v_i &amp; =&amp; \mathrm{gibbs}_{sampling}(v_{i-1})
\end{array}
$$
then for $n$ big enough we have
$$
v_n \sim P(v)
$$
   </p>
   <p>
    Let's try with $n=500$ Gibbs steps
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [116]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class=" highlight hl-ipython3">
     <pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">valid_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">valid_X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">v_probs</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">rbm_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">num_gibbs_step</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">draw_digit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v0</span><span class="p">,[</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">]),</span> <span class="s1">'un-labelled'</span><span class="p">,</span> <span class="s1">'random'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">draw_digit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v_probs</span><span class="p">,[</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">]),</span> <span class="s1">'un-labelled'</span><span class="p">,</span> <span class="s1">'random'</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_png output_subarea ">
     <img src="data:image/png;base64,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
QmCC
"/>
    </div>
   </div>
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_png output_subarea ">
     <img src="data:image/png;base64,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
RU5ErkJggg==
"/>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h2 id="RBM-applications">
    RBM applications
    <a class="anchor-link" href="#RBM-applications">
     ¶
    </a>
   </h2>
   <p>
    We can see the re-construction is not very clear but still keeps similar shape/constrat. Based on this properties, RBM can be applied in
   </p>
   <ul>
    <li>
     Dimension reduction: as seen above we can use 100 hidden units as a compression of input image (756) and we can re-construct the input from hidden unit.
    </li>
    <li>
     Feature learning: we can use 100 hidden units as features for example in classification e.g we use the hidden units in MNIST recognition tasks to see if we obtain a good accuracy.
    </li>
   </ul>
   <h3 id="MNIST-feature-learning">
    MNIST feature learning
    <a class="anchor-link" href="#MNIST-feature-learning">
     ¶
    </a>
   </h3>
   <p>
    After RBM is trained, we can use the mean activation $p(h_j=1|v)$ of the hidden layer as a representation of the data, then we train MNIST classification on that representation.
   </p>
  </div>
 </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
 <div class="input">
  <div class="prompt input_prompt">
   In [118]:
  </div>
  <div class="inner_cell">
   <div class="input_area">
    <div class=" highlight hl-ipython3">
     <pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="c1">##</span>
<span class="n">rbm_model</span><span class="o">.</span><span class="n">train_classification</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">valid_X</span><span class="p">,</span> <span class="n">valid_y</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">)</span>
</pre>
    </div>
   </div>
  </div>
 </div>
 <div class="output_wrapper">
  <div class="output">
   <div class="output_area">
    <div class="prompt">
    </div>
    <div class="output_subarea output_stream output_stdout output_text">
     <pre>Epoch (   1/ 500)Step    400 Loss 9.7097 Accuracy 56.92%%

Epoch (  25/ 500)Step  10700 Loss 1.6911 Accuracy 90.36%%

Epoch (  50/ 500)Step  21450 Loss 1.2404 Accuracy 92.30%

Epoch (  75/ 500)Step  32150 Loss 1.1578 Accuracy 93.02%

Epoch ( 100/ 500)Step  42900 Loss 0.9918 Accuracy 93.76%

Epoch ( 125/ 500)Step  53600 Loss 1.5491 Accuracy 94.42%

Epoch ( 150/ 500)Step  64350 Loss 0.3002 Accuracy 94.60%

Epoch ( 175/ 500)Step  75050 Loss 0.5762 Accuracy 94.62%

Epoch ( 200/ 500)Step  85800 Loss 0.6332 Accuracy 94.76%

Epoch ( 225/ 500)Step  96500 Loss 1.1959 Accuracy 94.96%

Epoch ( 250/ 500)Step 107250 Loss 0.8469 Accuracy 95.12%

Epoch ( 275/ 500)Step 117950 Loss 0.4703 Accuracy 95.32%

Epoch ( 300/ 500)Step 128700 Loss 0.0652 Accuracy 95.38%

Epoch ( 325/ 500)Step 139400 Loss 0.3154 Accuracy 95.46%

Epoch ( 350/ 500)Step 150150 Loss 0.5748 Accuracy 95.52%

Epoch ( 375/ 500)Step 160850 Loss 0.2889 Accuracy 95.58%

Epoch ( 400/ 500)Step 171600 Loss 0.3181 Accuracy 95.54%

Epoch ( 425/ 500)Step 182300 Loss 0.3644 Accuracy 95.68%

Epoch ( 450/ 500)Step 193050 Loss 0.2233 Accuracy 95.60%

Epoch ( 475/ 500)Step 203750 Loss 0.3654 Accuracy 95.64%

Epoch ( 500/ 500)Step 214500 Loss 0.5023 Accuracy 95.66%

</pre>
    </div>
   </div>
  </div>
 </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
 <div class="prompt input_prompt">
 </div>
 <div class="inner_cell">
  <div class="text_cell_render border-box-sizing rendered_html">
   <h3 id="Some-observations">
    Some observations
    <a class="anchor-link" href="#Some-observations">
     ¶
    </a>
   </h3>
   <p>
    The MNIST classification task resembles Neural-Network with 2 layers with sigmoid activation very much. The main different is
   </p>
   <ul>
    <li>
     The first layers weights and biases are learnt by unsupervised learning (via RBM)
    </li>
    <li>
     The net only changes the weights and biases at the last layer.
    </li>
   </ul>
   <p>
    The accuracy is not bad but can be improved for example
   </p>
   <ul>
    <li>
     increase number of hidden units
    </li>
    <li>
     using PCD instead of CD as decribed in Tijmen Tieleman 's
     <a href="http://www.machinelearning.org/archive/icml2008/papers/638.pdf">
      paper
     </a>
    </li>
   </ul>
   <p>
    We fixed some hyperparameters
   </p>
   <ul>
    <li>
     batch_size = 128 for both RBM training and MNIST classification
    </li>
    <li>
     epochs=20 for RBM training and
    </li>
    <li>
     epochs=500 for MNIST classification training
    </li>
   </ul>
   <p>
    We also implement SGD with momentum, however we observe that PCD works better without momentum so we turn on/off momentum-SGD for CD/PCD correspondingly.
   </p>
   <p>
    For CD &amp; PCD we obtain the following re-construction error
   </p>
   <table>
    <thead>
     <tr>
      <th style="text-align:center">
       hidden_dims
      </th>
      <th style="text-align:center">
       lr_rbm
      </th>
      <th style="text-align:center">
       re-construction err with CD
      </th>
      <th style="text-align:center">
       re-construction err with PCD
      </th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td style="text-align:center">
       100
      </td>
      <td style="text-align:center">
       0.1
      </td>
      <td style="text-align:center">
       0.0552
      </td>
      <td style="text-align:center">
       0.0512
      </td>
     </tr>
     <tr>
      <td style="text-align:center">
       200
      </td>
      <td style="text-align:center">
       0.1
      </td>
      <td style="text-align:center">
       0.0454
      </td>
      <td style="text-align:center">
       0.0404
      </td>
     </tr>
     <tr>
      <td style="text-align:center">
       500
      </td>
      <td style="text-align:center">
       0.1
      </td>
      <td style="text-align:center">
       0.0386
      </td>
      <td style="text-align:center">
       0.0342
      </td>
     </tr>
    </tbody>
   </table>
   <p>
    We summarize obtained classification results in the following tables
   </p>
   <table>
    <thead>
     <tr>
      <th style="text-align:center">
       hidden_dims
      </th>
      <th style="text-align:center">
       lr_mnist
      </th>
      <th style="text-align:center">
       mnist acc with CD
      </th>
      <th style="text-align:center">
       mnist acc with PCD
      </th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td style="text-align:center">
       100
      </td>
      <td style="text-align:center">
       0.1
      </td>
      <td style="text-align:center">
       92.78%
      </td>
      <td style="text-align:center">
       93.00%
      </td>
     </tr>
     <tr>
      <td style="text-align:center">
       200
      </td>
      <td style="text-align:center">
       0.1
      </td>
      <td style="text-align:center">
       93.82%
      </td>
      <td style="text-align:center">
       95.12%
      </td>
     </tr>
     <tr>
      <td style="text-align:center">
       500
      </td>
      <td style="text-align:center">
       0.1
      </td>
      <td style="text-align:center">
       94.86%
      </td>
      <td style="text-align:center">
       95.66%
      </td>
     </tr>
    </tbody>
   </table>
   <h2 id="Conclusion">
    Conclusion
    <a class="anchor-link" href="#Conclusion">
     ¶
    </a>
   </h2>
   <p>
    We have learnt standard RBM with binary value for visible &amp; hidden units, we learnt that RBMs can be applied in following applications
   </p>
   <ul>
    <li>
     dimension reduction
    </li>
    <li>
     feature representation learning: which is quite useful for learning from un-labeled data
    </li>
    <li>
     classification: using feature representation from RBMs, one can append a fully-connected layer + softmax to do classification task, we try it with MNIST and we achieve accuracy
    </li>
   </ul>
   <p>
    However RBMs has following dis-advantage
   </p>
   <ul>
    <li>
     it only has 2 layers: one visible and one hidden, so it can only learn one layer of non-linearity
    </li>
    <li>
     it can only model binary value 0,1
    </li>
   </ul>
   <p>
    To solve the first shortcoming, we can use stacked RBMs =&gt; Deep Belief Nets. For the second one, we can use Gaussian-Binary RBMs with ReLu activation (instead of sigmoid).
   </p>
  </div>
 </div>
</div>
